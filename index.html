<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Espa√ßo Reciclador com Joystick ‚ôªÔ∏èüöÄ</title>
<style>
  body {
    margin: 0; background: #000010; color: #eee; font-family: Arial, sans-serif; overflow: hidden;
    user-select: none;
    touch-action: none;
  }
  #gameCanvas {
    background: linear-gradient(to bottom, #001022, #000000);
    display: block;
    margin: auto;
    border: 3px solid #0ff;
    border-radius: 10px;
    touch-action: none;
  }
  #ui {
    position: absolute;
    top: 10px;
    left: 10px;
    color: #0ff;
    font-weight: bold;
    user-select:none;
  }
  button {
    background: #0ff;
    border: none;
    padding: 8px 12px;
    margin: 5px;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    user-select:none;
  }
  #message {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    color: #0ff;
    font-weight: bold;
    min-width: 200px;
    text-align: center;
    user-select:none;
  }
  #tutorialOverlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.85);
    color: #0ff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 22px;
    padding: 20px;
    text-align: center;
    z-index: 1000;
    user-select:none;
  }
  #tutorialOverlay button {
    margin-top: 20px;
    background: #0ff;
    color: #000;
    font-size: 20px;
    padding: 10px 20px;
  }
  /* Joystick container */
  #joystickContainer {
    position: absolute;
    bottom: 20px;
    left: 20px;
    width: 120px;
    height: 120px;
    background: rgba(0,255,255,0.15);
    border-radius: 50%;
    touch-action: none;
    user-select:none;
  }
  /* Joystick base */
  #joystickBase {
    position: absolute;
    width: 120px;
    height: 120px;
    border: 3px solid #0ff;
    border-radius: 50%;
    box-sizing: border-box;
  }
  /* Joystick knob */
  #joystickKnob {
    position: absolute;
    width: 50px;
    height: 50px;
    background: #0ff;
    border-radius: 50%;
    top: 35px;
    left: 35px;
    touch-action: none;
    user-select:none;
  }
</style>
</head>
<body>

<canvas id="gameCanvas" width="700" height="500"></canvas>

<div id="ui" style="display:none;">
  Energia: <span id="energy">0</span><br />
  Lixo recolhido: <span id="trashCount">0</span><br />
  <button id="scanBtn" disabled>Escanear lixo</button>
  <button id="collectBtn" disabled>Recolher lixo</button>
</div>

<div id="message"></div>

<!-- Tutorial -->
<div id="tutorialOverlay">
  <div id="tutorialText"></div>
  <button id="tutorialNextBtn">Come√ßar</button>
</div>

<!-- Joystick -->
<div id="joystickContainer" style="display:none;">
  <div id="joystickBase"></div>
  <div id="joystickKnob"></div>
</div>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  const energySpan = document.getElementById("energy");
  const trashCountSpan = document.getElementById("trashCount");
  const scanBtn = document.getElementById("scanBtn");
  const collectBtn = document.getElementById("collectBtn");
  const messageDiv = document.getElementById("message");
  const uiDiv = document.getElementById("ui");

  const tutorialOverlay = document.getElementById("tutorialOverlay");
  const tutorialText = document.getElementById("tutorialText");
  const tutorialNextBtn = document.getElementById("tutorialNextBtn");

  const joystickContainer = document.getElementById("joystickContainer");
  const joystickKnob = document.getElementById("joystickKnob");

  // Nave
  const ship = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    size: 40,
    speed: 3,
    energy: 0,
    trashCollected: 0
  };

  // Lixo espacial
  const trashTypes = [
    { type: "Pl√°stico", color: "#00ffff", energyValue: 5 },
    { type: "Metal", color: "#aaaaaa", energyValue: 10 },
    { type: "Org√¢nico", color: "#00aa00", energyValue: 3 },
    { type: "T√≥xico", color: "#ff3300", energyValue: -15 }
  ];

  let trashObjects = [];

  // Gerar lixo
  function generateTrash() {
    trashObjects = [];
    for (let i = 0; i < 15; i++) {
      let t = trashTypes[Math.floor(Math.random() * trashTypes.length)];
      trashObjects.push({
        x: Math.random() * (canvas.width - 20) + 10,
        y: Math.random() * (canvas.height - 20) + 10,
        size: 20 + Math.random() * 15,
        type: t.type,
        color: t.color,
        energyValue: t.energyValue,
        combined: false,
        id: i
      });
    }
  }

  generateTrash();

  // Controle joystick
  let joystickActive = false;
  let joystickCenter = {x:0, y:0};
  let joystickPos = {x:0, y:0};
  let moveVector = {x:0, y:0};
  const maxDistance = 40;

  function onStart(event) {
    event.preventDefault();
    joystickActive = true;
    const rect = joystickContainer.getBoundingClientRect();
    joystickCenter.x = rect.left + rect.width / 2;
    joystickCenter.y = rect.top + rect.height / 2;
    updateJoystickPosition(event);
  }
  function onMove(event) {
    if (!joystickActive) return;
    updateJoystickPosition(event);
  }
  function onEnd(event) {
    joystickActive = false;
    joystickKnob.style.transform = `translate(35px, 35px)`;
    moveVector.x = 0;
    moveVector.y = 0;
  }
  function updateJoystickPosition(event) {
    let clientX, clientY;
    if (event.touches && event.touches.length > 0) {
      clientX = event.touches[0].clientX;
      clientY = event.touches[0].clientY;
    } else {
      clientX = event.clientX;
      clientY = event.clientY;
    }
    let dx = clientX - joystickCenter.x;
    let dy = clientY - joystickCenter.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if (dist > maxDistance) {
      dx = dx / dist * maxDistance;
      dy = dy / dist * maxDistance;
      dist = maxDistance;
    }
    joystickKnob.style.transform = `translate(${35 + dx}px, ${35 + dy}px)`;
    moveVector.x = dx / maxDistance;
    moveVector.y = dy / maxDistance;
  }

  joystickContainer.addEventListener("mousedown", onStart);
  joystickContainer.addEventListener("touchstart", onStart);

  window.addEventListener("mousemove", onMove);
  window.addEventListener("touchmove", onMove, {passive:false});

  window.addEventListener("mouseup", onEnd);
  window.addEventListener("touchend", onEnd);

  // Tutorial texto e etapas
  const tutorialSteps = [
    "Bem-vindo ao Espa√ßo Reciclador! üöÄ‚ôªÔ∏è",
    "Use o joystick no canto inferior esquerdo para mover sua nave azul.",
    "Aproxime-se do lixo espacial para interagir com ele.",
    "Quando os bot√µes \"Escanear\" e \"Recolher\" ficarem ativos, voc√™ pode us√°-los.",
    "Escanear mostra o tipo do lixo e seu valor em energia.",
    "Recolher adiciona energia √† sua nave, mas cuidado com lixo t√≥xico!",
    "Seu objetivo √© coletar o m√°ximo de energia poss√≠vel para evoluir.",
    "Boa sorte, piloto! Pressione Come√ßar para iniciar o jogo."
  ];

  let tutorialIndex = 0;

  function showTutorialStep(index) {
    tutorialText.textContent = tutorialSteps[index];
    tutorialNextBtn.textContent = index === tutorialSteps.length - 1 ? "Come√ßar" : "Pr√≥ximo";
  }

  tutorialNextBtn.addEventListener("click", () => {
    tutorialIndex++;
    if (tutorialIndex >= tutorialSteps.length) {
      tutorialOverlay.style.display = "none";
      uiDiv.style.display = "block";
      joystickContainer.style.display = "block";
      gameStarted = true;
    } else {
      showTutorialStep(tutorialIndex);
    }
  });

  showTutorialStep(0);

  // Estado do jogo
  let currentTrash = null;
  let gameStarted = false;

  function update() {
    if (!gameStarted) return;

    // Movimento da nave via joystick
    ship.x += moveVector.x * ship.speed;
    ship.y += moveVector.y * ship.speed;

    // Limites da tela
    if (ship.x < ship.size / 2) ship.x = ship.size / 2;
    if (ship.x > canvas.width - ship.size / 2) ship.x = canvas.width - ship.size / 2;
    if (ship.y < ship.size / 2) ship.y = ship.size / 2;
    if (ship.y > canvas.height - ship.size / 2) ship.y = canvas.height - ship.size / 2;

    // Checar lixo pr√≥ximo
    currentTrash = trashObjects.find(t => {
      let dx = ship.x - t.x;
      let dy = ship.y - t.y;
      let dist = Math.sqrt(dx * dx + dy * dy);
      return dist < ship.size;
    });

    if (currentTrash) {
      scanBtn.disabled = false;
      collectBtn.disabled = false;
      messageDiv.textContent = `Lixo perto: ${currentTrash.type} (use os bot√µes)`;
    } else {
      scanBtn.disabled = true;
      collectBtn.disabled = true;
      messageDiv.textContent = "N√£o h√° lixo perto.";
    }

    energySpan.textContent = ship.energy;
    trashCountSpan.textContent = ship.trashCollected;
  }

  function drawShip() {
    ctx.fillStyle = "#0ff";
    ctx.beginPath();
    ctx.moveTo(ship.x, ship.y - ship.size / 2);
    ctx.lineTo(ship.x - ship.size / 2, ship.y + ship.size / 2);
    ctx.lineTo(ship.x + ship.size / 2, ship.y + ship.size / 2);
    ctx.closePath();
    ctx.fill();
  }

  function drawTrash() {
    trashObjects.forEach(t => {
      ctx.fillStyle = t.color;
      ctx.beginPath();
      ctx.arc(t.x, t.y, t.size / 2, 0, Math.PI * 2);
      ctx.fill();
      if (t.combined) {
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 2;
        ctx.stroke();
      }
    });
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawShip();
    drawTrash();
  }

  function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }

  scanBtn.onclick = () => {
    if (!currentTrash) return;
    alert(`Tipo: ${currentTrash.type}\nValor de energia: ${currentTrash.energyValue}`);
  };

  collectBtn.onclick = () => {
    if (!currentTrash) return;
    if (currentTrash.energyValue < 0) {
      ship.energy = Math.max(0, ship.energy + currentTrash.energyValue);
      alert("Lixo t√≥xico! Voc√™ perdeu energia!");
    } else {
      ship.energy += currentTrash.energyValue;
      ship.trashCollected++;
    }
    trashObjects = trashObjects.filter(t => t !== currentTrash);
    currentTrash = null;
  };

  gameLoop();
</script>

</body>
</html>
